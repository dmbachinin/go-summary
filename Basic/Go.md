# Go

- [Go](#go)
  - [Определение языка](#определение-языка)
  - [Особенности работы go](#особенности-работы-go)
  - [Работа с утилитой go](#работа-с-утилитой-go)
  - [Package](#package)
    - [Виды пакетов](#виды-пакетов)
    - [Как называются пакеты?](#как-называются-пакеты)
    - [Где Go ищет пакеты?](#где-go-ищет-пакеты)
  - [import](#import)
  - [go.mod](#gomod)
  - [Команды для работы с go.mod](#команды-для-работы-с-gomod)
    - [Как go.mod связан с импортом?](#как-gomod-связан-с-импортом)
    - [Go Modules vs GOPATH](#go-modules-vs-gopath)
  - [go.sum](#gosum)
    - [Как go.sum работает?](#как-gosum-работает)
    - [Пример go.sum и его расшифровка](#пример-gosum-и-его-расшифровка)
    - [Отличие `go.sum` от `go.mod`](#отличие-gosum-от-gomod)
  - [Сборщик мусора](#сборщик-мусора)
  - [Выравнивание памяти в Go](#выравнивание-памяти-в-go)

## Определение языка

Go является кроссплатформенным, он позволяет создавать программы под различные операционные системы - Windows, Mac OS, Linux, FreeBSD. Код обладает переносимостью: программы, написанные для одной из этих операционных систем, могут быть легко с перекомпиляцией перенесены на другую ОС.

Основные особенности языка Go:

- компилируемый - компилятор транслирует программу на Go в машинный код, понятный для определенной платформы
- статически типизированный
- присутствует сборщик мусора, который автоматически очищает память
- поддержка работы с сетевыми протоколами
- поддержка многопоточности и параллельного программирования

## Особенности работы go

✅ **Go запрещает неиспользуемые переменные, так что каждая объявленная переменная должна быть использована в коде.**

## Работа с утилитой go

```sh
    go mod init project #  создать модуль с названием project
    go run main.go # запуск проекта 
    go build main.go # собрать проект в исполняемый файл
    go build # собрать модуль в исполняемый файл

    # go.mod
    go get github.com/gin-gonic/gin # При добавлении нового пакета (go get) он записывается в go.mod
    go get -u github.com/gin-gonic/gin # Обновляет пакет до последней minor или patch версии
    go get -u=patch github.com/gin-gonic/gin # Обновляет только patch-версию (например, 1.8.0 → 1.8.2)
    go mod tidy # Удаление неиспользуемых пакетов
    go list -m all # Выводит список всех зависимостей
    go mod edit -go=1.21 # Обновляет версию Go в go.mod
    go mod verify # Проверить зависимость вручную. Проверяет все зависимости из `go.sum`
```

## Package

В Go **packages (пакеты)** — это основа организации кода. Они позволяют структурировать код, делать его переиспользуемым и управлять зависимостями. В Go каждый файл принадлежит какому-то пакету.

✅ **Каждый файл Go принадлежит пакету. В начале каждого .go файла обязательно указывается директива package**

В Go **файлы внутри одного пакета могут использовать друг друга без явного импорта**. Это позволяет разбивать код на несколько файлов, но при этом они остаются частью одного логического модуля

Основные принципы взаимодействия файлов в одном пакете:

1. Все файлы одного пакета должны начинаться с одного и того же имени пакета (package mypackage).
2. ✅ **Функции, переменные и структуры, объявленные с заглавной буквы, доступны в других файлах** того же пакета и в других пакетах.
3. ✅ **Элементы, объявленные с маленькой буквы, доступны только внутри этого пакета**

### Виды пакетов

1. main - точно входа в приложение
2. service/... - свой пакет
3. fmt - пакет из стандартной библиотеки
4. github.com/gabriel-vasile/mimetype - внешний пакет

### Как называются пакеты?

1. **Имя пакета обычно совпадает с именем его директории**
2. Хорошей практикой считается называть пакеты в единственном числе (mathutils, config, storage)
3. Имя пакета не должно конфликтовать с импортируемыми стандартными библиотеками (например, не называйте пакет fmt)

### Где Go ищет пакеты?

Go ищет пакеты в нескольких местах:

- В стандартной библиотеке.
- В GOROOT — это путь к стандартным библиотекам Go.
- В GOPATH — каталог с пользовательскими пакетами.
- В go.mod (если используется Go Modules).

## import

В Go импорт (import) используется для подключения стандартных библиотек, сторонних пакетов и внутренних модулей проекта.

**Виды импорта в Go:**

```go
    import "fmt" // Обычный импорт

    import ( // Импорт нескольких пакетов
        "fmt"                // стандартная библиотека
        "github.com/gin-gonic/gin" // сторонний пакет
        "project/utils"      // локальный модуль
    )

    import m "math" // Импорт с псевдонимом (именованный импорт)


    import (
    "database/sql"
        _ "github.com/lib/pq" // Используется, когда пакет нужен только для его инициализации, но напрямую его функции использовать не нужно
        // Подключаем PostgreSQL-драйвер
    )
    // При таком импорте вызывается функция init() из github.com/lib/pq, но сам пакет в коде не используется

    import . "fmt" // Можно импортировать пакет так, чтобы его функции можно было вызывать без префикса пакета
```

**Как работает импорт в Go?**

В Go компилятор ищет пакеты в нескольких местах:

1. Стандартные пакеты (GOROOT)
    - Хранятся в системных каталогах Go ($GOROOT).
    - Примеры: fmt, math, strings.
2. Внешние пакеты (GOPATH/pkg/mod)
    - После установки через go get пакеты попадают в GOPATH/pkg/mod.
3. Локальные модули (go.mod)
    - В go.mod указывается, какие пакеты принадлежат проекту.
    - Файлы ищутся в каталогах проекта.

## go.mod

Файл **go.mod** — это файл управления модулями в Go. Он управляет зависимостями, определяет версию Go и содержит информацию о пакете

**Файл go.mod решает несколько задач:**

- Определяет модуль проекта (его имя и путь).
- Хранит список зависимостей (внешних пакетов с версиями).
- Обеспечивает воспроизводимость сборки (фиксируя версии).
- Позволяет управлять зависимостями (обновлять, удалять, фиксировать версии).

Создать go.mod можно командой:

```sh
    go mod init myproject
```

## Команды для работы с go.mod

```sh
    go get github.com/gin-gonic/gin # При добавлении нового пакета (go get) он записывается в go.mod
    go get -u github.com/gin-gonic/gin # Обновляет пакет до последней minor или patch версии
    go get -u=patch github.com/gin-gonic/gin # Обновляет только patch-версию (например, 1.8.0 → 1.8.2)
    go mod tidy # Удаление неиспользуемых пакетов
    go list -m all # Выводит список всех зависимостей
    go mod edit -go=1.21 # Обновляет версию Go в go.mod
    go mod verify # Проверить зависимость вручную. Проверяет все зависимости из `go.sum`
```

: ****

**Как работает go.mod?**

```plaintext
    module myproject // Определяет имя модуля (обычно это путь к репозиторию: github.com/username/repo)

    go 1.20 // Указывает минимальную версию Go

    // Все зависимости кэшируются в $GOPATH/pkg/mod (больше не нужна vendor)
    require (
        github.com/gin-gonic/gin v1.8.1
        github.com/google/uuid v1.3.0
    ) // Список зависимостей проекта и их версий

    replace (
        github.com/old/package v1.2.3 => github.com/new/package v1.4.0
    ) // Позволяет заменить одну зависимость на другую
    // Это полезно, если оригинальная библиотека устарела или была форкнута

    exclude github.com/bad/package v1.0.0 // Исключает определенные версии пакетов. Go не будет использовать v1.0.0 и выберет другую версию
```

### Как go.mod связан с импортом?

| Функция | `import` | `go.mod` |
|---------|---------|---------|
| **Что делает?** | Загружает пакеты в коде | Управляет зависимостями |
| **Как работает?** | `import "fmt"` позволяет использовать `fmt.Println()` | `require fmt v1.0.0` фиксирует версию |
| **Где хранится?** | В `.go` файлах | В `go.mod` |
| **Управляет версиями?** | ❌ Нет | ✅ Да |
| **Удаляет неиспользуемые пакеты?** | ❌ Нет | ✅ `go mod tidy` |

**Пример:**

```go
    import (
        "fmt"
        "github.com/google/uuid" // Go не знает, какую версию github.com/google/uuid использовать. Если в go.mod нет этой зависимости, она добавится автоматически после go run main.go
    )
```

### Go Modules vs GOPATH

**Раньше (до Go 1.11) в Go не было `go.mod`, и использовался `GOPATH`**.

| Функция | `GOPATH` | `Go Modules (go.mod)` |
|---------|---------|----------------|
| **Как хранятся зависимости?** | В `GOPATH/src/` | В `go.mod` и `GOPATH/pkg/mod` |
| **Как фиксируются версии?** | ❌ Никак | ✅ Версии фиксируются |
| **Можно ли использовать несколько версий одного пакета?** | ❌ Нет | ✅ Да |
| **Где хранятся файлы?** | В `GOPATH/src` | В проекте (`go.mod`) |

Теперь **GOPATH не нужен** — все управляется через `go.mod`!

## go.sum

`go.sum` — это **файл контроля целостности зависимостей** в Go. Он автоматически создаётся при работе с Go Modules и хранит **хеши (контрольные суммы) всех зависимостей**.

**Основные задачи `go.sum`:**

- Проверяет, что загруженные зависимости **не были изменены** злоумышленниками.  
- Обеспечивает **воспроизводимость сборки** (один и тот же код всегда использует одни и те же зависимости).  
- Позволяет кешировать зависимости, не загружая их повторно.  

`go.sum` создаётся **автоматически**, как только проект использует `go mod init` или `go get`.

✅ **`go.sum` нужно коммитить**, потому что:

- Он **гарантирует, что у всех разработчиков будут те же зависимости**.
- Без него `go mod tidy` может **получить другие версии пакетов**.

### Как go.sum работает?

Когда Go загружает зависимость (`go get`), он:

1. **Скачивает код пакета** и вычисляет его хеш.
2. **Сравнивает его с `go.sum`**, если он уже есть.
3. Если хеша **нет в `go.sum`**, Go записывает его туда.
4. Если хеш **не совпадает** с сохранённым, Go **выдаёт ошибку безопасности**.

### Пример go.sum и его расшифровка

```plaintext
github.com/google/uuid v1.3.0 h1:WxOfAxBx2...
github.com/google/uuid v1.3.0/go.mod h1:XxYzW...
```

**Разберём запись:**

- `github.com/google/uuid v1.3.0` — это **версия пакета**.
- `h1:` — означает, что используется **SHA-256** в формате `base64`.
- `WxOfAxBx2...` — это **контрольная сумма** содержимого пакета.
- `/go.mod` — означает, что это **хеш самого файла `go.mod`** в этом пакете.

### Отличие `go.sum` от `go.mod`

| Функция | `go.mod` | `go.sum` |
|---------|---------|---------|
| **Что делает?** | Определяет зависимости | Проверяет целостность зависимостей |
| **Где используется?** | В управлении модулями | В проверке безопасности |
| **Как обновляется?** | `go get`, `go mod tidy` | Автоматически при загрузке пакетов |
| **Можно ли удалять?** | ❌ Нет (без него код не соберётся) | 🚫 Не рекомендуется |

## Сборщик мусора

## Выравнивание памяти в Go
